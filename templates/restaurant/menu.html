{% extends 'base.html' %}

{% block title %}Menu - {{ restaurant_name|default:"Restaurant" }}{% endblock %}

{% block extra_css %}
<style>
    .product-card {
        transition: all 0.3s ease;
        height: 480px; /* Increased height a bit more */
        border: none;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-radius: 8px;
        overflow: hidden;
    }

    .product-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .product-image {
        height: 200px; /* Increased from 160px to 200px */
        width: 100%;
        object-fit: cover;
    }

    .no-image-placeholder {
        height: 200px; /* Increased to match product-image height */
        width: 100%;
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6c757d;
        font-size: 2rem;
    }

    .category-tabs {
        position: sticky !important;
        top: 56px !important; /* Account for navbar height */
        z-index: 1040 !important;
        background: rgba(255, 255, 255, 0.95) !important;
        border-bottom: 1px solid rgba(0,0,0,0.1) !important;
        margin-bottom: 0;
        box-shadow: 0 2px 15px rgba(0,0,0,0.12) !important;
        padding: 0.3rem 0;
        transition: all 0.3s ease;
        backdrop-filter: blur(15px) !important;
        -webkit-backdrop-filter: blur(15px) !important;
    }

    .category-tabs.stuck {
        box-shadow: 0 4px 20px rgba(0,0,0,0.15) !important;
        backdrop-filter: blur(20px) !important;
        background: rgba(255, 255, 255, 0.98) !important;
    }

    /* Enhanced mobile sticky positioning */
    @media (max-width: 768px) {
        .category-tabs {
            position: sticky !important;
            top: 56px !important; /* Reduced gap - closer to navbar */
            z-index: 1040 !important;
            background: transparent !important;
            backdrop-filter: blur(15px) !important;
            -webkit-backdrop-filter: blur(15px) !important;
            box-shadow: 0 2px 15px rgba(0,0,0,0.12) !important;
            border-bottom: 1px solid rgba(0,0,0,0.1) !important;
            margin-top: -5px !important; /* Reduce space from top */
        }
        
        .category-tabs.stuck {
            box-shadow: 0 3px 20px rgba(0,0,0,0.2) !important;
            background: transparent !important;
        }
    }

    @media (max-width: 576px) {
        .category-tabs {
            position: sticky !important;
            top: 56px !important; /* Reduced gap - closer to navbar */
            z-index: 1040 !important;
            background: transparent !important;
            backdrop-filter: blur(15px) !important;
            -webkit-backdrop-filter: blur(15px) !important;
            box-shadow: 0 2px 15px rgba(0,0,0,0.12) !important;
            margin-top: -5px !important; /* Reduce space from top */
        }
        
        .category-tabs.stuck {
            box-shadow: 0 3px 20px rgba(0,0,0,0.2) !important;
        }
    }

    /* Mobile-first responsive design for category tabs */
    @media (max-width: 768px) {
        .category-tabs {
            padding: 0.15rem 0;
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            box-shadow: 0 1px 2px rgba(0,0,0,0.03);
            border-bottom: 1px solid #f1f3f4;
        }
        
        .category-tabs .container {
            padding: 0;
            max-width: 100%;
            width: 100%;
        }
        
        .category-tabs .d-flex {
            flex-direction: row;
            gap: 0;
            justify-content: flex-start;
        }
        
        /* Hide cart button on tablets */
        .category-tabs .ms-3 {
            display: none;
        }
    }

    @media (max-width: 576px) {
        .category-tabs {
            padding: 0.18rem 0;
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
            border-bottom: 1px solid #e9ecef;
        }
        
        .category-tabs .container {
            padding: 0 0.2rem;
        }
        
        /* Hide cart button on mobile */
        .category-tabs .ms-3 {
            display: none !important;
        }
    }

    .nav-tabs {
        border: none;
        padding: 0 1rem;
        margin: 0;
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE/Edge */
        scroll-behavior: smooth; /* Smooth scrolling */
        -webkit-overflow-scrolling: touch; /* iOS smooth scrolling */
        display: flex;
        flex-wrap: nowrap; /* Never wrap to new line */
        justify-content: flex-start;
        align-items: center;
        width: 100%;
        gap: 0.5rem;
    }

    .nav-tabs::-webkit-scrollbar {
        display: none; /* Chrome/Safari */
    }

    /* Carousel-style fade indicators */
    .category-tabs {
        position: relative;
    }

    .category-tabs::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 10px;
        background: linear-gradient(to right, rgba(255,255,255,0.9), transparent);
        pointer-events: none;
        z-index: 2;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .category-tabs::after {
        content: '';
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        width: 10px;
        background: linear-gradient(to left, rgba(255,255,255,0.9), transparent);
        pointer-events: none;
        z-index: 2;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .category-tabs.show-left-fade::before {
        opacity: 1;
    }

    .category-tabs.show-right-fade::after {
        opacity: 1;
    }

    @media (max-width: 576px) {
        .category-tabs::before,
        .category-tabs::after {
            width: 8px;
        }
    }

    /* Mobile optimization for nav tabs */
    @media (max-width: 768px) {
        .nav-tabs {
            display: flex;
            flex-wrap: nowrap; /* Force single row carousel */
            padding: 0.02rem 0.03rem;
            gap: 0.1rem;
            justify-content: flex-start;
            position: relative;
            width: 100%;
        }
        
        .nav-tabs .nav-item {
            flex-shrink: 0; /* Don't shrink items */
            min-width: fit-content;
        }
        
        /* Carousel-style scrolling behavior */
        .nav-tabs {
            scroll-snap-type: x mandatory;
        }
        
        .nav-tabs .nav-item {
            scroll-snap-align: start;
        }
    }

    @media (max-width: 576px) {
        .nav-tabs {
            padding: 0.03rem 0.05rem;
            gap: 0.12rem;
            justify-content: flex-start;
        }
        
        /* Carousel optimization for small screens */
        .nav-tabs .nav-link {
            min-width: fit-content;
            max-width: 90px; /* Slightly larger for better readability */
            text-overflow: ellipsis;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        /* Smoother carousel scrolling on mobile */
        .nav-tabs {
            scroll-padding: 20px;
        }
    }

    .nav-tabs .nav-link {
        border: none;
        padding: 0.4rem 0.8rem;
        font-weight: 600;
        color: #6c757d;
        transition: all 0.3s ease;
        border-radius: 20px;
        margin: 0;
        background: #f8f9fa;
        font-size: 0.8rem;
        white-space: nowrap;
        display: flex;
        align-items: center;
        min-width: fit-content;
        /* Make category tabs same width as product cards */
        flex: 1;
        max-width: 200px;
        justify-content: center;
        text-align: center;
        flex-shrink: 0;
    }

    /* Mobile-first nav link styling */
    @media (max-width: 768px) {
        .nav-tabs .nav-link {
            padding: 0.1rem 0.25rem;
            font-size: 0.5rem;
            font-weight: 600;
            margin: 0;
            border-radius: 6px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid rgba(0,0,0,0.06);
            box-shadow: 0 1px 1px rgba(0,0,0,0.01);
            min-width: auto;
            flex-shrink: 0;
        }
    }

    @media (max-width: 576px) {
        .nav-tabs .nav-link {
            padding: 0.12rem 0.28rem;
            font-size: 0.52rem;
            border-radius: 7px;
            box-shadow: 0 1px 1px rgba(0,0,0,0.01);
            font-weight: 620;
            letter-spacing: 0;
        }
        
        .nav-tabs .nav-link i {
            font-size: 0.5rem;
            margin-right: 0.1rem;
        }
    }

    .nav-tabs .nav-link:hover {
        border-color: transparent;
        color: #495057;
        background: #e9ecef;
        transform: translateY(-1px);
    }

    /* Mobile hover effects */
    @media (max-width: 768px) {
        .nav-tabs .nav-link:hover {
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
            transform: translateY(-1px) scale(1.01);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
    }

    @media (max-width: 576px) {
        .nav-tabs .nav-link:hover {
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 2px 10px rgba(0,0,0,0.12);
        }
    }

    .nav-tabs .nav-link.active {
        background: linear-gradient(135deg, #495057, #343a40);
        color: white;
        border-color: transparent;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(73, 80, 87, 0.3);
    }

    /* Mobile active state styling */
    @media (max-width: 768px) {
        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, #495057, #343a40);
            color: white;
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 2px 8px rgba(73, 80, 87, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    }

    @media (max-width: 576px) {
        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, #495057, #343a40);
            transform: translateY(-1px) scale(1.03);
            box-shadow: 0 2px 10px rgba(73, 80, 87, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.15);
            font-weight: 700;
        }
    }

    .tab-content {
        padding-top: 1rem;
    }

    .price-badge {
        background: linear-gradient(135deg, #fd7e14, #ff8c00);
        color: white;
        font-weight: 700;
        font-size: 1rem;
        padding: 0.4rem 0.8rem;
        border-radius: 15px;
        box-shadow: 0 2px 6px rgba(253, 126, 20, 0.3);
    }
    
    .promotional-price {
        background: linear-gradient(135deg, #28a745, #20c997) !important;
        box-shadow: 0 2px 6px rgba(40, 167, 69, 0.3) !important;
        animation: priceGlow 2s infinite;
    }
    
    @keyframes priceGlow {
        0%, 100% { box-shadow: 0 2px 6px rgba(40, 167, 69, 0.3); }
        50% { box-shadow: 0 4px 12px rgba(40, 167, 69, 0.5); }
    }
    
    .original-price {
        font-size: 0.9rem;
        margin-bottom: 0.2rem;
    }
    
    .price-section {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }
    
    .happy-hour-badge {
        background: linear-gradient(45deg, #ff6b6b, #ffa500);
        color: white;
        padding: 0.2rem 0.5rem;
        border-radius: 10px;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        margin-top: 0.3rem;
        animation: happyHourPulse 1.5s infinite;
    }
    
    @keyframes happyHourPulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.05); opacity: 0.9; }
    }

    .subcategory-section {
        margin-bottom: 2rem;
    }

    /* Make only the subcategory header bar match product card widths */
    .subcategory-card {
        background: linear-gradient(135deg, #ffffff, #f8f9fa);
        border-radius: 8px;
        border: 1px solid #e9ecef;
        box-shadow: 0 3px 10px rgba(0,0,0,0.06);
        overflow: hidden;
        margin-bottom: 1.5rem;
        width: 100%; /* Keep full width for the entire card */
    }

    /* Only the subcategory HEADER BAR matches product card width */
    .subcategory-header {
        background: linear-gradient(135deg, #495057, #343a40);
        color: white;
        padding: 0.25rem 0.7rem;
        position: relative;
        overflow: hidden;
        /* Make header bar take full width of container */
        width: 100%;
        margin: 0;
        border-radius: 8px;
        margin-bottom: 1rem;
    }

    @media (max-width: 991.98px) {
        .subcategory-header {
            width: 100%; /* Full width */
        }
    }

    @media (max-width: 767.98px) {
        .subcategory-header {
            width: 100%; /* Full width on mobile */
            margin-bottom: 0.5rem;
        }
    }

    .subcategory-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.05"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.05"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.03"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        pointer-events: none;
    }

    .subcategory-title {
        position: relative;
        z-index: 1;
        margin: 0;
        font-size: 0.8rem;
        font-weight: 700;
    }

    .subcategory-icon {
        background: rgba(255,255,255,0.2);
        padding: 0.1rem;
        border-radius: 3px;
        font-size: 0.65rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 20px;
    }

    .subcategory-description {
        position: relative;
        z-index: 1;
        margin: 0.05rem 0 0 0;
        opacity: 0.9;
        font-size: 0.6rem;
    }

    .products-grid {
        padding: 1rem;
    }

    /* Make subcategory cards match product card widths in grid layout */
    .subcategory-wrapper {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    @media (min-width: 992px) {
        .subcategory-wrapper {
            grid-template-columns: repeat(3, 1fr); /* 3 columns like product cards (col-lg-4) */
        }
    }

    @media (min-width: 768px) and (max-width: 991.98px) {
        .subcategory-wrapper {
            grid-template-columns: repeat(2, 1fr); /* 2 columns like product cards (col-md-6) */
        }
    }

    @media (max-width: 767.98px) {
        .subcategory-wrapper {
            grid-template-columns: 1fr; /* Single column on mobile */
        }
    }

    .add-to-cart-btn {
        background: #d63384;
        border: none;
        border-radius: 15px;
        padding: 0.5rem 0.4rem; /* Reduced left/right padding from 1rem to 0.4rem */
        font-weight: 600;
        transition: all 0.3s ease;
        color: white;
        font-size: 0.85rem;
    }

    .add-to-cart-btn:hover {
        background: #b02a5b;
        transform: scale(1.03);
        color: white;
        box-shadow: 0 3px 10px rgba(214, 51, 132, 0.4);
    }

    .qty-controls {
        background: #f8f9fa;
        border-radius: 15px;
        border: 2px solid #e9ecef;
        display: flex;
        align-items: center;
        overflow: hidden;
    }

    .qty-btn {
        border: none;
        background: transparent;
        width: 30px;
        height: 30px;
        color: #495057;
        font-weight: bold;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
    }

    .qty-btn:hover {
        background: #495057;
        color: white;
    }

    .qty-input {
        border: none;
        background: transparent;
        text-align: center;
        font-weight: 600;
        width: 65px; /* Increased width from 45px to 65px */
        height: 30px;
        font-size: 0.85rem;
    }

    .menu-header {
        background: linear-gradient(135deg, #495057, #343a40);
        color: white;
        border-radius: 10px;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 15px rgba(73, 80, 87, 0.3);
        position: relative;
        overflow: hidden;
    }

    .menu-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="headerGrain" width="50" height="50" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="white" opacity="0.1"/><circle cx="40" cy="40" r="0.5" fill="white" opacity="0.05"/></pattern></defs><rect width="100" height="100" fill="url(%23headerGrain)"/></svg>');
        pointer-events: none;
    }

    .menu-header-content {
        position: relative;
        z-index: 1;
    }

    .category-info-badge {
        background: rgba(255,255,255,0.15);
        color: white;
        padding: 0.15rem 0.3rem;
        border-radius: 6px;
        font-size: 0.6rem;
        display: inline-block;
    }

    .product-info-section {
        padding: 1rem;
    }

    .product-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #343a40;
        margin-bottom: 0.4rem;
    }

    .product-description {
        color: #6c757d;
        font-size: 0.85rem;
        line-height: 1.4;
        margin-bottom: 0.8rem;
    }

    .product-meta {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .product-details {
        font-size: 0.75rem;
        color: #6c757d;
    }

    .stock-info {
        color: #28a745;
        font-weight: 600;
        font-size: 0.75rem;
    }

    .prep-time {
        color: #fd7e14;
        font-weight: 500;
        font-size: 0.75rem;
    }

    /* Cart Button Height Alignment */
    .category-tabs .btn-outline-dark {
        height: auto;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.4rem 0.7rem;  /* Reduced padding for smaller height */
        margin: 0.2rem 0;        /* Reduced margin */
        border-radius: 18px;     /* Slightly smaller border radius */
        font-weight: 600;
        font-size: 0.75rem;      /* Slightly smaller font */
        gap: 0.4rem;             /* Space between icon/text and count */
    }
    
    /* Cart count with border instead of badge */
    .category-tabs .cart-count-border {
        background: transparent;
        border: 1.5px solid #dc3545;
        color: #dc3545;
        padding: 0.15rem 0.4rem;
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: 700;
        min-width: 24px;
        text-align: center;
        line-height: 1;
    }

    /* Mobile Cart Button Styling */
    @media (max-width: 768px) {
        .category-tabs .btn-outline-dark {
            background: linear-gradient(135deg, #28a745, #218838) !important;
            color: white !important;
            border: 1px solid transparent !important;
            padding: 0.3rem 0.6rem !important; /* Reduced padding for mobile */
            font-size: 0.7rem !important;
            font-weight: 600 !important;
            border-radius: 15px !important;
            box-shadow: 0 1px 4px rgba(40, 167, 69, 0.15) !important;
            transition: all 0.3s ease !important;
        }
        
        .category-tabs .btn-outline-dark:hover {
            transform: translateY(-1px) scale(1.02) !important;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.2) !important;
        }
        
        /* Mobile cart count styling */
        .category-tabs .cart-count-border {
            background: rgba(255, 255, 255, 0.9) !important;
            border: 1.5px solid #fff !important;
            color: #28a745 !important;
            font-weight: 800 !important;
        }
        
        .category-tabs .badge {
            font-size: 0.6rem !important;
            padding: 0.15rem 0.3rem !important;
        }
    }

    @media (max-width: 576px) {
        .category-tabs .btn-outline-dark {
            padding: 0.4rem 0.8rem !important;
            font-size: 0.72rem !important;
            border-radius: 16px !important;
            box-shadow: 0 1px 6px rgba(40, 167, 69, 0.2) !important;
            font-weight: 620 !important;
        }
        
        .category-tabs .btn-outline-dark:hover {
            transform: translateY(-1px) scale(1.03) !important;
            box-shadow: 0 2px 10px rgba(40, 167, 69, 0.25) !important;
        }
        
        .category-tabs .badge {
            font-size: 0.62rem !important;
            padding: 0.18rem 0.35rem !important;
        }
    }

    /* Mobile touch improvements */
    @media (max-width: 768px) {
        .nav-tabs .nav-link,
        .category-tabs .btn-outline-dark {
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
            -webkit-touch-callout: none;
            user-select: none;
            cursor: pointer;
        }
        
        /* Add subtle animation for mobile interactions */
        .nav-tabs .nav-link:active {
            transform: scale(0.95);
        }
        
        .category-tabs .btn-outline-dark:active {
            transform: scale(0.95);
        }
    }

    /* New Category Cards Styles */
    .category-card {
        transition: all 0.3s ease;
        height: 400px;
        border: none;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
    }

    .category-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .category-card-image {
        height: 250px;
        width: 100%;
        object-fit: cover;
    }

    .category-info-section {
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        height: 150px;
        justify-content: space-between;
    }

    .category-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 0.5rem;
    }

    .category-description {
        font-size: 0.9rem;
        color: #6c757d;
        line-height: 1.4;
        margin-bottom: 0.8rem;
    }

    .category-meta {
        margin-bottom: 0.5rem;
    }

    .stats-section {
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
        color: #6c757d;
    }

    .stat-item {
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }

    .click-indicator {
        text-align: center;
        font-size: 0.85rem;
        color: #007bff;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    /* Product List Styles in Modal */
    .product-list-item {
        padding: 1rem;
        border-bottom: 1px solid #eee;
        transition: background-color 0.2s ease;
    }

    .product-list-item:hover {
        background-color: #f8f9fa;
    }

    .product-list-item:last-child {
        border-bottom: none;
    }

    .product-name {
        font-weight: 600;
        color: #333;
        margin-bottom: 0.3rem;
    }

    .product-description-text {
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }

    .product-details-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .product-price {
        font-weight: 600;
        color: #007bff;
        font-size: 1.1rem;
    }

    .product-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    /* Mobile Optimizations for Modal */
    @media (max-width: 768px) {
        /* Make modal TRULY full screen on mobile */
        .modal-dialog {
            margin: 0 !important;
            max-width: 100% !important;
            width: 100vw !important;
            height: 100vh !important;
        }
        
        .modal-content {
            height: 100vh !important;
            border-radius: 0 !important;
            border: none !important;
            width: 100% !important;
        }
        
        .modal-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #dee2e6;
        }
        
        .modal-body {
            padding: 0.5rem;
            overflow-y: auto;
            max-height: calc(100vh - 60px);
        }
        
        /* Product cards in modal - stack vertically */
        .modal-body .row > div[class*="col-"] {
            padding: 0.5rem !important;
        }
        
        .modal-body .card {
            margin-bottom: 0.5rem;
        }
        
        /* Compact product card design for mobile */
        .modal-body .card-body {
            padding: 0.75rem;
        }
        
        .modal-body .card-title {
            font-size: 0.95rem;
            margin-bottom: 0.3rem;
        }
        
        .modal-body .card-text {
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }
        
        /* Price and stock on same line */
        .modal-body .d-flex.justify-content-between {
            font-size: 0.85rem;
        }
        
        /* Quantity controls - more compact */
        .modal-body .quantity-controls {
            gap: 0.3rem;
        }
        
        .modal-body .form-control {
            width: 50px !important;
            font-size: 0.85rem;
            padding: 0.25rem;
        }
        
        .modal-body .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }
        
        /* Add to Cart button - full width on mobile */
        .modal-body .btn-primary {
            white-space: nowrap;
        }
        
        /* Subcategory tabs - scrollable */
        .modal-body .nav-tabs {
            flex-wrap: nowrap;
            overflow-x: auto;
            border-bottom: 1px solid #dee2e6;
        }
        
        .modal-body .nav-link {
            font-size: 0.85rem;
            padding: 0.5rem 0.75rem;
            white-space: nowrap;
        }
    }
    
    @media (max-width: 576px) {
        /* Extra small devices - even more compact */
        .modal-body {
            padding: 0.25rem;
        }
        
        .modal-body .card-body {
            padding: 0.5rem;
        }
        
        .modal-body .card-title {
            font-size: 0.9rem;
        }
        
        .modal-body .card-text {
            font-size: 0.75rem;
        }
        
        .modal-body .h6 {
            font-size: 0.85rem;
        }
        
        .modal-body small {
            font-size: 0.7rem;
        }
        
        /* Stack quantity and button vertically on very small screens */
        .modal-body .d-flex.justify-content-between.align-items-center:last-child {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .modal-body .quantity-controls {
            width: 100%;
            justify-content: center;
        }
        
        .modal-body .btn-primary {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- CSRF Token for AJAX -->
{% csrf_token %}

<!-- Header -->
<div class="menu-header p-3 text-center">
    <div class="menu-header-content">
        <h2 class="mb-2">
            <i class="bi bi-menu-button-wide"></i> {{ restaurant_name|default:"Restaurant" }} Menu
        </h2>
        <p class="mb-3">Table {{ table_number }} â€¢ Discover our amazing culinary creations</p>
        <div class="d-flex gap-2 justify-content-center flex-wrap">
            <a href="{% url 'orders:view_cart' %}" class="btn btn-light rounded-pill px-3 py-2" id="viewCartBtn">
                <i class="bi bi-cart3"></i> View Cart (<span id="cartCount">{{ cart_count|default:0 }}</span>)
            </a>
            <a href="{% url 'orders:select_table' %}" class="btn btn-outline-light rounded-pill px-3 py-2">
                <i class="bi bi-arrow-left"></i> Change Table
            </a>
        </div>
    </div>
</div>

{% if categories %}
    <!-- Category Cards Display -->
    <div class="container">
        <div class="categories-grid mt-4">
            <div class="row g-4">
                {% for category in categories %}
                    {% if category.subcategories.all or category.products.all %}
                        <div class="col-lg-4 col-md-6">
                            <div class="card category-card h-100" data-bs-toggle="modal" data-bs-target="#categoryModal" data-category-id="{{ category.id }}" data-category-name="{{ category.name }}">
                                <!-- Category Image -->
                                {% if category.image %}
                                    <img src="{{ category.image.url }}" 
                                         alt="{{ category.name }}" 
                                         class="category-card-image">
                                {% else %}
                                    <div class="no-image-placeholder">
                                        <i class="bi bi-folder"></i>
                                    </div>
                                {% endif %}

                                <div class="category-info-section">
                                    <!-- Category Title -->
                                    <h5 class="category-title">{{ category.name }}</h5>
                                    
                                    <!-- Category Description -->
                                    {% if category.description %}
                                        <p class="category-description">
                                            {{ category.description|truncatewords:15 }}
                                        </p>
                                    {% endif %}

                                    <!-- Category Stats -->
                                    <div class="category-meta">
                                        <div class="stats-section">
                                            <div class="stat-item">
                                                <i class="bi bi-folder-plus"></i>
                                                {{ category.subcategories.count }} subcategories
                                            </div>
                                            <div class="stat-item">
                                                <i class="bi bi-basket"></i>
                                                View Menu
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Click indicator -->
                                    <div class="click-indicator">
                                        <i class="bi bi-arrow-right-circle"></i>
                                        Click to explore
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal fade" id="categoryModal" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-fullscreen-md-down">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="categoryModalLabel">Category Menu</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Subcategory Tabs -->
                    <ul class="nav nav-tabs" id="subcategoryTabs" role="tablist">
                        <!-- Will be populated by JavaScript -->
                    </ul>
                    
                    <!-- Subcategory Content -->
                    <div class="tab-content mt-3" id="subcategoryTabContent">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Keep the old structure hidden for reference -->
    <div style="display: none;">
        <div class="tab-content" id="categoryTabContent">
            {% for category in categories %}
                <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" 
                     id="category-{{ category.id }}" 
                     role="tabpanel" 
                     aria-labelledby="tab-{{ category.id }}">

                    {% if category.subcategories.all %}
                        {% for subcategory in category.subcategories.all %}
                            {% if subcategory.products.all %}
                                <div class="subcategory-section">
                                    <div class="subcategory-card">
                                        <!-- Subcategory Header -->
                                        <div class="subcategory-header">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div class="d-flex align-items-center">
                                                    <span class="subcategory-icon me-3">
                                                        <i class="bi bi-list-ul"></i>
                                                    </span>
                                                    <div>
                                                        <h3 class="subcategory-title mb-1">{{ subcategory.name }}</h3>
                                                        {% if subcategory.description %}
                                                            <p class="subcategory-description mb-0">{{ subcategory.description }}</p>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="category-info-badge">
                                                    <i class="bi bi-basket"></i> {{ subcategory.products.all|length }} items available
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Products Grid -->
                                        <div class="products-grid">
                                            <div class="row g-4">
                                                {% for product in subcategory.products.all %}
                                                    {% if product.is_available %}
                                                        <div class="col-lg-4 col-md-6">
                                                            <div class="card product-card h-100">
                                                                <!-- Product Image -->
                                                                {% if product.main_category.image %}
                                                                    <img src="{{ product.main_category.image.url }}" 
                                                                         alt="{{ product.name }}" 
                                                                         class="product-image">
                                                                {% else %}
                                                                    <div class="no-image-placeholder">
                                                                        <i class="bi bi-image"></i>
                                                                    </div>
                                                                {% endif %}

                                                                <div class="product-info-section">
                                                                    <!-- Product Title -->
                                                                    <h5 class="product-title">{{ product.name }}</h5>
                                                                    
                                                                    <!-- Product Description -->
                                                                    <p class="product-description">
                                                                        {{ product.description|truncatewords:12 }}
                                                                    </p>

                                                                    <!-- Product Meta Information -->
                                                                    <div class="product-meta">
                                                                        <div class="price-section">
                                                                            {% if product.has_active_promotion %}
                                                                                <div class="original-price text-decoration-line-through text-muted">${{ product.price }}</div>
                                                                                <div class="price-badge promotional-price">${{ product.get_current_price }}</div>
                                                                                <div class="happy-hour-badge">
                                                                                    <i class="fas fa-fire"></i> {{ product.get_active_promotion.discount_percentage|floatformat:0 }}% OFF
                                                                                </div>
                                                                            {% else %}
                                                                                <div class="price-badge">${{ product.price }}</div>
                                                                            {% endif %}
                                                                        </div>
                                                                        <div class="product-details text-end">
                                                                            {% if product.preparation_time %}
                                                                                <div class="prep-time">
                                                                                    <i class="bi bi-clock"></i> {{ product.preparation_time }} min
                                                                                </div>
                                                                            {% endif %}
                                                                            <div class="stock-info">
                                                                                <i class="bi bi-check-circle"></i> {{ product.available_in_stock }} in stock
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Add to Cart Controls -->
                                                                    {% if product.available_in_stock > 0 %}
                                                                        <div class="d-flex align-items-center gap-3">
                                                                            <!-- Quantity Controls -->
                                                                            <div class="qty-controls">
                                                                                <button class="qty-btn" type="button" data-action="decrease" data-product="{{ product.id }}">
                                                                                    <i class="bi bi-dash"></i>
                                                                                </button>
                                                                                <input type="number" 
                                                                                       class="qty-input form-control" 
                                                                                       id="qty-{{ product.id }}" 
                                                                                       value="1" 
                                                                                       min="1" 
                                                                                       max="{{ product.available_in_stock }}" 
                                                                                       data-product="{{ product.id }}">
                                                                                <button class="qty-btn" type="button" data-action="increase" data-product="{{ product.id }}">
                                                                                    <i class="bi bi-plus"></i>
                                                                                </button>
                                                                            </div>

                                                                            <!-- Add to Cart Button -->
                                                                            <button class="btn add-to-cart-btn flex-grow-1" data-product="{{ product.id }}">
                                                                                <i class="bi bi-cart-plus me-2"></i> Add to Cart
                                                                            </button>
                                                                        </div>
                                                                    {% else %}
                                                                        <button class="btn btn-secondary w-100 rounded-pill" disabled>
                                                                            <i class="bi bi-x-circle"></i> Out of Stock
                                                                        </button>
                                                                    {% endif %}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-5">
                            <i class="bi bi-exclamation-triangle display-4 text-warning mb-3"></i>
                            <h4>No items available in this category</h4>
                            <p class="text-muted">Please check other categories or contact our staff.</p>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>
{% else %}
    <div class="container">
        <div class="text-center py-5">
            <i class="bi bi-exclamation-triangle display-4 text-warning mb-3"></i>
            <h4>No Menu Categories Available</h4>
            <p class="text-muted">Please check back later or contact our staff.</p>
        </div>
    </div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded - Modal functionality starting');

    // Handle category card clicks
    document.querySelectorAll('.category-card').forEach(card => {
        card.addEventListener('click', function() {
            const categoryName = this.getAttribute('data-category-name');
            console.log('Category clicked:', categoryName);
            
            // Update modal title
            document.getElementById('categoryModalLabel').textContent = categoryName + ' Menu';

            // Get containers
            const tabsContainer = document.getElementById('subcategoryTabs');
            const contentContainer = document.getElementById('subcategoryTabContent');
            
            // Clear existing content
            tabsContainer.innerHTML = '';
            contentContainer.innerHTML = '';

            // Build categories data safely from Django template
            let categoriesData = {};
            
            {% if categories %}
            {% for category in categories %}
            {% with subcat_list=category.subcategories.all %}
            {% if subcat_list %}
            categoriesData['{{ category.name|escapejs }}'] = {
                'id': {{ category.id }},
                'subcategories': {}
            };
            {% for subcategory in subcat_list %}
            {% with prod_list=subcategory.products.all %}
            {% if prod_list %}
            categoriesData['{{ category.name|escapejs }}'].subcategories['{{ subcategory.name|escapejs }}'] = {
                'id': {{ subcategory.id }},
                'products': [
                    {% for product in prod_list %}
                    {
                        'id': {{ product.id }},
                        'name': '{{ product.name|escapejs }}',
                        'description': '{{ product.description|escapejs|truncatechars:100 }}',
                        'price': '{{ product.get_current_price }}',
                        'original_price': '{{ product.price }}',
                        'stock': {{ product.available_in_stock }},
                        'is_available': {{ product.is_available|yesno:"true,false" }},
                        'has_promotion': false
                    }{% if not forloop.last %},{% endif %}
                    {% endfor %}
                ]
            };
            {% endif %}
            {% endwith %}
            {% endfor %}
            {% endif %}
            {% endwith %}
            {% endfor %}
            {% endif %}

            console.log('Categories data:', categoriesData);

            // Check if category exists in real data
            if (categoriesData[categoryName] && 
                categoriesData[categoryName].subcategories && 
                Object.keys(categoriesData[categoryName].subcategories).length > 0) {
                
                console.log('Using dynamic data for', categoryName);
                const subcategories = categoriesData[categoryName].subcategories;
                const subcategoryNames = Object.keys(subcategories);
                
                // Create tabs for real subcategories
                let tabsHtml = '';
                let contentHtml = '';
                    
                    subcategoryNames.forEach((subName, index) => {
                        const isActive = index === 0 ? 'active' : '';
                        const showActive = index === 0 ? 'show active' : '';
                        const tabId = subName.toLowerCase().replace(/[^a-z0-9]/g, '');
                        
                        // Create tab
                        tabsHtml += `
                            <li class="nav-item">
                                <button class="nav-link ${isActive}" data-bs-toggle="tab" data-bs-target="#${tabId}" type="button">
                                    <i class="bi bi-list-ul me-1"></i>${subName}
                                </button>
                            </li>
                        `;
                        
                        // Create content
                        const products = subcategories[subName].products;
                        let productsHtml = '';
                        
                        if (products.length > 0) {
                            products.forEach(product => {
                                if (product.is_available && product.stock > 0) {
                                    const priceDisplay = product.has_promotion ? 
                                        `<span class="h6 mb-0 text-success">$${product.price}</span> <small class="text-muted text-decoration-line-through">$${product.original_price}</small>` :
                                        `<span class="h6 mb-0">$${product.price}</span>`;
                                    
                                    productsHtml += `
                                        <div class="col-md-4 mb-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h6 class="card-title">${product.name}</h6>
                                                    <p class="card-text">${product.description}</p>
                                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                                        ${priceDisplay}
                                                        <small class="text-muted">Stock: ${product.stock}</small>
                                                    </div>
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div class="quantity-controls d-flex align-items-center">
                                                            <button class="btn btn-outline-secondary btn-sm" onclick="changeQty('prod${product.id}', -1)">
                                                                <i class="bi bi-dash"></i>
                                                            </button>
                                                            <input type="number" id="qty-prod${product.id}" class="form-control mx-2 text-center" 
                                                                   value="1" min="1" max="${product.stock}" style="width: 60px;">
                                                            <button class="btn btn-outline-secondary btn-sm" onclick="changeQty('prod${product.id}', 1)">
                                                                <i class="bi bi-plus"></i>
                                                            </button>
                                                        </div>
                                                        <button class="btn btn-primary btn-sm" onclick="addToCartDemo('${product.name}', ${product.id})">
                                                            <i class="bi bi-cart-plus me-1"></i>Add to Cart
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }
                            });
                        } else {
                            productsHtml = '<div class="col-12"><p class="text-muted">No products available in this subcategory.</p></div>';
                        }
                        
                        contentHtml += `
                            <div class="tab-pane fade ${showActive}" id="${tabId}">
                                <div class="p-4">
                                    <h5>${subName}</h5>
                                    <div class="row">
                                        ${productsHtml}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                tabsContainer.innerHTML = tabsHtml;
                contentContainer.innerHTML = contentHtml;
            } else {
                console.log('Using hardcoded fallback for', categoryName);
                useHardcodedFallback(categoryName, tabsContainer, contentContainer);
            }

            // Show the modal
            const modalElement = document.getElementById('categoryModal');
            const modal = new bootstrap.Modal(modalElement);
            
            // Add event listener to properly clean up when modal is closed
            modalElement.addEventListener('hidden.bs.modal', function () {
                // Remove any lingering backdrops
                const backdrops = document.querySelectorAll('.modal-backdrop');
                backdrops.forEach(backdrop => backdrop.remove());
                
                // Reset body classes
                document.body.classList.remove('modal-open');
                document.body.style.overflow = '';
                document.body.style.paddingRight = '';
            }, { once: true });
            
            modal.show();
        });
    });
});

// Simple demo functions
function changeQty(id, change) {
    const input = document.getElementById('qty-' + id);
    let qty = parseInt(input.value) + change;
    const max = parseInt(input.max);
    if (qty < 1) qty = 1;
    if (qty > max) qty = max;
    input.value = qty;
}

function addToCartDemo(productName, productId = null) {
    // For demo products without real IDs, just show alert
    if (!productId) {
        alert(productName + ' added to cart! (Demo mode)');
        return;
    }
    
    // Get quantity from the input field
    const qtyInput = document.getElementById('qty-prod' + productId);
    const quantity = qtyInput ? parseInt(qtyInput.value) : 1;
    
    // Real cart functionality for actual products
    fetch('{% url "orders:add_to_cart" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            product_id: productId,
            quantity: quantity
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Add to cart response:', data);
        if (data.success) {
            showAlert(data.message, 'success');
            console.log('Updating cart count to:', data.cart_count);
            updateCartCount(data.cart_count);
        } else {
            showAlert(data.message, 'danger');
        }
    })
    .catch(error => {
        console.error('Error adding to cart:', error);
        showAlert('Error adding item to cart', 'danger');
    });
}

// Function to get CSRF token from cookies
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Function to update cart count display
function updateCartCount(count) {
    console.log('updateCartCount called with count:', count);
    
    // Method 1: Update just the count span (most efficient)
    const cartCountSpan = document.getElementById('cartCount');
    if (cartCountSpan) {
        cartCountSpan.textContent = count;
        console.log('Cart count span updated successfully');
    } else {
        console.warn('Cart count span not found');
    }
    
    // Method 2: Fallback - update the entire button if span not found
    const viewCartBtn = document.getElementById('viewCartBtn');
    if (viewCartBtn && !cartCountSpan) {
        viewCartBtn.innerHTML = `<i class="bi bi-cart3"></i> View Cart (<span id="cartCount">${count}</span>)`;
        console.log('Cart button updated successfully');
    }
    
    // Method 3: Final fallback - search by href
    if (!cartCountSpan && !viewCartBtn) {
        const btnByHref = document.querySelector('a[href*="view_cart"]');
        if (btnByHref) {
            btnByHref.innerHTML = `<i class="bi bi-cart3"></i> View Cart (${count})`;
            console.log('Cart button updated via href search');
        } else {
            console.error('Could not find cart button by any method');
        }
    }
}

// Hardcoded fallback function for categories not in database
function useHardcodedFallback(categoryName, tabsContainer, contentContainer) {
    if (categoryName === 'Beverages') {
        // Simple single-tab layout for Beverages
        tabsContainer.innerHTML = `
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#beverages-all" type="button">
                    <i class="bi bi-list-ul me-1"></i>All Beverages
                </button>
            </li>
        `;
        
        contentContainer.innerHTML = `
            <div class="tab-pane fade show active" id="beverages-all">
                <div class="p-4">
                    <h5>Beverages</h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title">Coffee</h6>
                                    <p class="card-text">Fresh brewed coffee</p>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span class="h6 mb-0">$3.99</span>
                                        <small class="text-muted">Available</small>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="quantity-controls d-flex align-items-center">
                                            <button class="btn btn-outline-secondary btn-sm" onclick="changeQty('prod10', -1)">
                                                <i class="bi bi-dash"></i>
                                            </button>
                                            <input type="number" id="qty-prod10" class="form-control mx-2 text-center" 
                                                   value="1" min="1" max="20" style="width: 60px;">
                                            <button class="btn btn-outline-secondary btn-sm" onclick="changeQty('prod10', 1)">
                                                <i class="bi bi-plus"></i>
                                            </button>
                                        </div>
                                        <button class="btn btn-primary btn-sm" onclick="addToCartDemo('Coffee', 10)">
                                            <i class="bi bi-cart-plus me-1"></i>Add to Cart
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title">Hot Chocolate</h6>
                                    <p class="card-text">Rich hot chocolate</p>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span class="h6 mb-0">$4.99</span>
                                        <small class="text-muted">Available</small>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="quantity-controls d-flex align-items-center">
                                            <button class="btn btn-outline-secondary btn-sm" onclick="changeQty('prod12', -1)">
                                                <i class="bi bi-dash"></i>
                                            </button>
                                            <input type="number" id="qty-prod12" class="form-control mx-2 text-center" 
                                                   value="1" min="1" max="15" style="width: 60px;">
                                            <button class="btn btn-outline-secondary btn-sm" onclick="changeQty('prod12', 1)">
                                                <i class="bi bi-plus"></i>
                                            </button>
                                        </div>
                                        <button class="btn btn-primary btn-sm" onclick="addToCartDemo('Hot Chocolate', 12)">
                                            <i class="bi bi-cart-plus me-1"></i>Add to Cart
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    } else {
        // Simple fallback for other categories
        contentContainer.innerHTML = `
            <div class="p-4">
                <h5>${categoryName} Items</h5>
                <p class="text-muted">No items available in this category at the moment.</p>
            </div>
        `;
    }
}

function showAlert(message, type) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    alertDiv.style.cssText = 'top: 100px; right: 20px; z-index: 9999; min-width: 300px; max-width: 400px;';
    alertDiv.innerHTML = `
        <div class="d-flex align-items-center">
            <i class="bi bi-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>
            <span>${message}</span>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.body.appendChild(alertDiv);
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 4000);
}

// Unregister any service workers to prevent auto-reload
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for (let registration of registrations) {
            registration.unregister().then(function(success) {
                if (success) {
                    console.log('Service worker unregistered successfully');
                }
            });
        }
    });
}
</script>
{% endblock %}
